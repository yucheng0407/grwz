<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="/test/medias/css/zTreeStyle/zTreeStyle.css" rel="stylesheet">
    <script type="text/javascript" src="/test/medias/js/require.js"></script>
    <script type="text/javascript" src="/test/medias/js/loadJs.js"></script>
    <script type="text/javascript">
        <!--
        load({
            module: ["/medias/js/ztree/ztree.js", "/medias/js/ztree/ztree.excheck.js", "/medias/js/ztree/ztree.exedit.js"],
            success: function () {
                var setting = {
                    async: {
                        enable: true,
                        url: YC.handleUrl("/tree/getMenu"),
                        autoParam: ["id"],
                        otherParam: {"otherParam": "zTreeAsyncTest"}
                    },
                    edit: {
                        enable: true,
                        editNameSelectAll: true,
                        removeTitle: "删除节点",
                        renameTitle: "编辑节点名称",
                        showRemoveBtn: true,
                        showRenameBtn: true
                    },
                    check: {
                        enable: true,
                        chkboxType: {"Y": "ps", "N": "s"}
                    },
                    view: {
                        showLine: false
                    },
                    data: {
                        simpleData: {
                            enable: true
                        }
                    },
                    callback: {
                        beforeCheck: beforeCheck
                    }
                };


                $(document).ready(function () {
                    $.fn.zTree.init($("#treeDemo"), setting);
                });
                /**
                 * 勾选
                 * @param event
                 * @param treeId  树对象
                 * @param treeNode 树节点
                 */
                function onCheck(event, treeId, treeNode) {
                    var treeObj = $.fn.zTree.getZTreeObj(treeId);
                    if (treeNode.checked) {
                        treeObj.expandNode(treeNode, true, true, true)
                    }
                    else treeObj.expandNode(treeNode, false, true, true)
                }

                /**
                 * 勾选之前
                 * @param event
                 * @param treeId  树对象
                 * @param treeNode 树节点
                 */
                function beforeCheck(treeId, treeNode) {
                    var treeObj = $.fn.zTree.getZTreeObj(treeId);
                        if (!treeNode.checked) {
                            expandAllNodes(treeId,treeNode);
                        }
                        else treeObj.expandNode(treeNode, false, true, true);//折叠
                }

                /**
                 * 展示
                 * @param event
                 * @param treeId  树对象
                 * @param treeNode 树节点
                 */
                function showRemoveBtn(treeId, treeNode) {
                    return !treeNode.isFirstNode;
                }

                function showRenameBtn(treeId, treeNode) {
                    return !treeNode.isFirstNode;
                }

                function filter(treeId, parentNode, childNodes) {
                    if (!childNodes) return null;
                    for (var i = 0, l = childNodes.length; i < l; i++) {
                        childNodes[i].name = childNodes[i].name.replace(/\.n/g, '.');
                        childNodes[i].icon = YC.handleUrl("/medias/css/zTreeStyle/img/diy/3.png");
                    }
                    return childNodes;
                }
                /**
                 * 全部展示
                 * @param event
                 * @param treeId  树对象
                 * @param treeNode 树节点
                 */
                function expandAllNodes(treeId,node) {
                    if (!node) return;
                    var treeObj = $.fn.zTree.getZTreeObj(treeId);
                    if (node.isParent) {
                        if(!node.zAsync){
                        treeObj.reAsyncChildNodes(node, "refresh", false, function () {//异步
                            treeObj.checkNode(node, true, true);
                            for (var i=0, l= node.children.length; i<l; i++) {
                                expandAllNodes(treeId,node.children[i]);
                            }
                        });
                        }else {
                            treeObj.expandNode(node, true, false, true)//展开一级
                            for (var i=0, l= node.children.length; i<l; i++) {
                                expandAllNodes(treeId,node.children[i]);
                            }
                        }
                    }
                }
            }

        });
        //-->
    </script>
</head>
<body>
<div class="content_wrap">
    <div class="zTreeDemoBackground left">
        <ul id="treeDemo" class="ztree"></ul>
    </div>
</div>
</body>
</html>